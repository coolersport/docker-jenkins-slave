#!/bin/bash

[[ -n "$ZONE" ]] && ZONE="--zone $ZONE"
[[ -n "$REGION" ]] && REGION="--region $REGION"

gcsSetStatus stopping

for pool in ${POOL_NAMES?required}; do
    gcloud container clusters resize ${CLUSTER_NAME?required} \
      --node-pool $pool \
      --num-nodes 0 \
      --project ${PROJECT_ID?required} \
      $ZONE $REGION \
      --quiet
    [[ $? -gt 0 ]] && exit 1
done

for name in ${DB_NAMES}; do
    sqlSetState $name ALWAYS NEVER
done

gsutil rm gs://${BUCKET_NAME?required}/scaledown 2>/dev/null

gcsSetStatus stopped
