#!/bin/bash

[[ -n "$ZONE" ]] && ZONE="--zone $ZONE"
[[ -n "$REGION" ]] && REGION="--region $REGION"

for pool in ${POOL_NAMES?required}; do
	size=`gcloud container node-pools describe $pool \
		  --cluster ${CLUSTER_NAME?required} \
		  --project ${PROJECT_ID?required} \
		  $ZONE $REGION \
		  --format "value(initialNodeCount)"`
	if [[ ${size:-0} -eq 0 ]]; then
		echo "scaleup"
	else
		echo "nothing"
		gsutil rm gs://${BUCKET_NAME?required}/scaledown 2>/dev/null
		date +%s > /tmp/last.scaleup
		gsutil cp /tmp/last.scaleup gs://$BUCKET_NAME/
	fi
	break # only check the first pool
done